<body>
  <main>
    <% if flash[:notice] %>
      <%= flash[:notice] %>
    <% end %>

    <% if @book && @book.errors.any? %>
      <%= @book.errors.count %> error
      <ul>
        <% @book.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    <% end %>

    <p id="notice"></p>

    <div class="container px-5 px-sm-0">
      <div class="row">
        <div class="col-md-3">
          <h2>User info</h2>
          <% if @book && @book.user && @book.user.avatar.attached? %> 
            <%= image_tag @book.user.avatar, size: "100x100" %>
          <% else %>
            <%= image_tag 'default-image', size: "100x100" %>
          <% end %> 

          <table class="table table-hover table-inverse custom-table">
            <tr>
              <th class="text-left">name</th>
              <td><%= @book.user.name if @book && @book.user %></td>
            </tr>
            <tr>
              <th class="text-left">introduction</th>
              <td><%= @book.user.introduction if @book && @book.user %></td>
            </tr>
          </table>

          <div class="row">
            <% if @book && @book.user %>
              <%= link_to edit_user_path(@book.user), class: 'btn btn-outline-secondary btn-block' do %>
                <i class="fa-solid fa-user-gear" style="color: #696e77;"></i>
              <% end %> 
            <% end %>
          </div>

          <%= form_with model: Book.new, local: true do |f| %>
            <h2 class="mt-3">New book</h2>
            <div class="form-group">
              <%= f.label :title %><br />
              <%= f.text_field :title %><br>
            </div>
            <div class="form-group">
              <%= f.label :opinion %><br />
              <%= f.text_area :body %>
            </div>
            <div class="actions">
              <%= f.submit "Create Book", class: "btn btn-success" %>
            </div>
          <% end %>
        </div>

        <div class="col-md-8 offset-md-1">
          <table class="table table-hover table-inverse custom-table">
            <h2>Book detail</h2>

            <% if user_signed_in? %>
              <tr>
 <td>
  <% if @book && @book.user %>
    <% if @book.user.avatar.attached? %>
      <%= image_tag @book.user.avatar, size: "100x100" %>
    <% else %>
      <%= image_tag 'default-image', size: "100x100" %>
    <% end %>
    <br>
    <%= link_to @book.user.name, user_path(@book.user) %>
  <% end %>
</td>
<td>
  <%= link_to @book.title, book_path(@book) if @book %>
</td>

                <td>
                  <%= @book.body if @book && @book.user %>
                </td>
                <td>
                  <% if @book && @book.user && user_signed_in? && @book.user == current_user %>
                    <%= link_to "Edit", edit_book_path(@book), class: "btn btn-success btn-sm" %>
                  <% end %>
                </td>
                <td>
                  <% if @book && @book.user && user_signed_in? && @book.user == current_user %>
                    <%= link_to "Destroy", book_path(@book), method: :delete, data: { confirm: "Are you sure?" }, class:"btn btn-sm btn-danger" %>
                  <% end %> 
                </td>
              </tr>
            <% end %>
          </table>
        </div>
      </div>
    </div>
  </main>
</body>
